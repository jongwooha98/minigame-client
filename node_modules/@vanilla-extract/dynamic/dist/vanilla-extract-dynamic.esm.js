import { walkObject, get, getVarName } from '@vanilla-extract/private';

function assignInlineVars(varsOrContract, tokens) {
  const styles = {};

  if (typeof tokens === 'object') {
    const contract = varsOrContract;
    walkObject(tokens, (value, path) => {
      const varName = get(contract, path);
      styles[getVarName(varName)] = String(value);
    });
  } else {
    const vars = varsOrContract;

    for (const varName in vars) {
      styles[getVarName(varName)] = vars[varName];
    }
  }

  Object.defineProperty(styles, 'toString', {
    value: function () {
      return Object.keys(this).map(key => `${key}:${this[key]}`).join(';');
    },
    writable: false
  });
  return styles;
}

function setVar(element, variable, value) {
  element.style.setProperty(getVarName(variable), value);
}

function setElementVars(element, varsOrContract, tokens) {
  if (typeof tokens === 'object') {
    const contract = varsOrContract;
    walkObject(tokens, (value, path) => {
      setVar(element, get(contract, path), String(value));
    });
  } else {
    const vars = varsOrContract;

    for (const varName in vars) {
      setVar(element, varName, vars[varName]);
    }
  }
}

export { assignInlineVars, setElementVars };
